
# Snake Game with Rust and WebAssembly Tutorial

This tutorial will guide you through the structure and functionality of the Snake game, developed with Rust and WebAssembly.

## Prerequisites

- **Rust:** Install via [rustup](https://rustup.rs/).
- **wasm-pack:** Install with `cargo install wasm-pack`.

## Project Overview and File Structure

The project is structured to run both as a native application and in a web browser using WebAssembly.

### `src` Folder - Source Code

- **`src/lib.rs`**: The heart of your Rust library. Contains the main game logic, which is shared between the native executable and WebAssembly. Conditional compilation (`#[cfg(...)]`) ensures that `wasm-bindgen` specific code is only used for the web target.
- **`src/main.rs`**: The entry point for native compilation (EXE). It acts as a standard Rust program that imports and uses the functionality of your library (`lib.rs`).
- **`src/index.html`**: The web page that the end-user will open in the browser. Its sole function is to load the JavaScript script that initializes WASM.
- **`src/index.js`**: The "launcher" for your WebAssembly. It imports the WASM module, initializes it, and calls the exported Rust functions. It also manages memory and other complex interactions.
- **`src/bootstrap.js`**: This file is responsible for importing `index.js` and handling import errors.

### `pkg` Folder - WebAssembly Package

This folder is **automatically generated** by `wasm-pack`. It contains everything needed to use your Rust code in the browser.

- **`snake_game_bg.wasm`**: Your Rust code compiled into the WebAssembly binary format. This is the file that the browser actually executes.
- **`snake_game.js`**: The JavaScript "glue" generated by `wasm-bindgen`. It creates a bridge between JavaScript and your WASM code, allowing you to call Rust functions directly from your JS code.
- **`snake_game.d.ts`**: Type definition file for TypeScript. Provides autocompletion and type checking if you are using TypeScript in your web project.
- **`package.json`**: A manifest file that describes this package, listing the files that compose it. It is useful for integration with modern JavaScript ecosystems.

## Game Logic (`src/lib.rs`)

The `src/lib.rs` file is the heart of the game. It defines the main data structures and game logic.

### Data Structures

- **`Direction`**: Enum representing the possible directions of the snake (Up, Down, Left, Right).
- **`Point`**: Struct representing a point on the game grid, with `x` and `y` coordinates.
- **`Snake`**: Struct representing the snake, containing its body (a vector of `Point`) and the current direction.
- **`Game`**: Main struct containing the game state, including the grid width and height, the snake, the food, the score, and the "game over" state.

### Core Logic

- **`Game::new()`**: Creates a new instance of the game.
- **`Game::tick()`**: Advances the game state by one time "tick". It moves the snake, checks for collisions with the walls and its own body, and checks if the snake has eaten the food.
- **`Game::change_snake_direction()`**: Changes the direction of the snake.
- **`Game::spawn_food()`**: Spawns new food at a random position on the grid.

## WebAssembly Version

The WebAssembly version is compiled from `src/lib.rs` and is exposed to JavaScript through `wasm-bindgen`.

### `#[cfg(target_arch = "wasm32")]`

This conditional compilation attribute ensures that the code within the `mod wasm` block is only compiled when the target is `wasm32`.

### `WasmGame`

Inside the `wasm` module, the `WasmGame` struct acts as a wrapper around the main `Game` struct. This allows exposing a more JavaScript-friendly API.

### `src/index.js`

This file is responsible for:

1.  **Initializing WebAssembly**: Loads the generated `snake_game.js` module.
2.  **Setting up the Canvas**: Gets the canvas element from the HTML and sets its dimensions.
3.  **Creating the Game Instance**: Creates a new instance of `Game` from the WebAssembly module.
4.  **Handling User Input**: Adds an event listener for the arrow keys to control the snake.
5.  **Game Loop**: The `gameLoop` function is called repeatedly to update and draw the game state on the canvas.

## Native Version (`src/main.rs`)

The native version uses the `ggez` library to create a window and draw the game.

### `#[cfg(not(target_arch = "wasm32"))]`

This attribute ensures that the code in `src/main.rs` is not compiled for the WebAssembly target.

### `AppState`

The `AppState` struct stores the application state for `ggez`, which in this case is the `Game` instance.

### `EventHandler`

The `EventHandler` implementation for `AppState` defines how the game responds to events such as frame updates (`update`) and rendering (`draw`), as well as keyboard input (`key_down_event`).

## How to Run

### Web Version

1.  Make sure you have `wasm-pack` installed.
2.  Compile the project to WebAssembly: `wasm-pack build --target web`
3.  Start a local web server in the project's root directory (e.g., with `npm start`).
4.  Open your browser to `http://localhost:8080` (or the port your server is using).

### Native Version

1.  Run the project with Cargo: `cargo run`

